<!DOCTYPE html>
<html lang="en" data-bs-theme="dark" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@v0.180.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@v0.180.0/examples/jsm/"
        }
    }
    </script>
    <title>AutonoTorpedo Control Center V1</title>
    <style>
        .accordion {
            margin-bottom: 10px;
        }

        .code-block {
            background: black;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .code-block > * {
            color: white;
            overflow: scroll;
        }

        .code-block:has(>#log) {
            min-height: 100px;
            max-height: 50vh;
        }

        .dataGroup {
            display: flex;
            flex-direction: column;
            margin-top: 10px;
            margin-bottom: 20px;
            border-left: 1px solid white;
            border-bottom: 1px solid white;
            border-radius: 0 0 0 10px;
            padding: 5px 0 15px 15px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="d-flex flex-column m-3">
        <h1>AutonoTorpedo Control Center V1</h1>
        <h4 class="m-2"><b>Status:</b> 
            <span class="state-based show-not-connected badge text-bg-secondary">Not Connected</span>
            <span class="state-based show-setup badge text-bg-primary">Setup</span>
            <span class="state-based show-active badge text-bg-success">Active</span>
        </h4>
        <hr>
        <div class="row flex flex-row">
            <div class="col flex flex-column">
                <div class="accordion">
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-actions" aria-expanded="true" aria-controls="accordion-actions">
                            Actions
                        </button>
                        </h3>
                        <div id="accordion-actions" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                        <div class="accordion-body flex flex-column">
                            <button id="connect-btn" type="button" class="state-based show-not-connected btn btn-primary">Connect</button>
                            <button id="send-ping-btn" type="button" class="state-based show-setup btn btn-primary">Send Ping</button>
                            <button id="calibrate-mag-btn" type="button" class="state-based show-setup btn btn-primary">Calibrate Magnetometer</button>
                        </div>
                        </div>
                    </div>
                </div>
                <div class="accordion state-based show-setup show-active">
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-log" aria-expanded="true" aria-controls="accordion-log">
                            Log
                        </button>
                        </h3>
                        <div id="accordion-log" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                            <div class="d-flex flex-column accordion-body">
                                <div class="code-block" style="max-height: 300px; overflow: scroll;"><code id="log"></code></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col flex flex-column">
                <div class="accordion state-based show-setup show-active">
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-info" aria-expanded="true" aria-controls="accordion-info">
                            Info
                        </button>
                        </h3>
                        <div id="accordion-info" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                        <div id="accordion-info-area" class="accordion-body overflow-hidden">
                            <b>IMU/Magnetometer Data: </b>
                            <div class="dataGroup" id="imuMagCollapse">
                                <div>Magnetometer: <span id="magData">[---,---nT, ---,---nT, ---,---nT]</span></div>
                                <div>Acceleration: <span id="accData">[--.----g, --.----g, --.----g]</span></div>
                                <hr>
                                <div id="3d-viewer" class="border position-relative" style="width: fit-content">
                                    <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                                    <!-- <button type="button" class="btn btn-outline-primary position-absolute" style="top: 3%; right: 3%; z-index: 10">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
                                            <path d="M259.1 73.5C262.1 58.7 275.2 48 290.4 48L350.2 48C365.4 48 378.5 58.7 381.5 73.5L396 143.5C410.1 149.5 423.3 157.2 435.3 166.3L503.1 143.8C517.5 139 533.3 145 540.9 158.2L570.8 210C578.4 223.2 575.7 239.8 564.3 249.9L511 297.3C511.9 304.7 512.3 312.3 512.3 320C512.3 327.7 511.8 335.3 511 342.7L564.4 390.2C575.8 400.3 578.4 417 570.9 430.1L541 481.9C533.4 495 517.6 501.1 503.2 496.3L435.4 473.8C423.3 482.9 410.1 490.5 396.1 496.6L381.7 566.5C378.6 581.4 365.5 592 350.4 592L290.6 592C275.4 592 262.3 581.3 259.3 566.5L244.9 496.6C230.8 490.6 217.7 482.9 205.6 473.8L137.5 496.3C123.1 501.1 107.3 495.1 99.7 481.9L69.8 430.1C62.2 416.9 64.9 400.3 76.3 390.2L129.7 342.7C128.8 335.3 128.4 327.7 128.4 320C128.4 312.3 128.9 304.7 129.7 297.3L76.3 249.8C64.9 239.7 62.3 223 69.8 209.9L99.7 158.1C107.3 144.9 123.1 138.9 137.5 143.7L205.3 166.2C217.4 157.1 230.6 149.5 244.6 143.4L259.1 73.5zM320.3 400C364.5 399.8 400.2 363.9 400 319.7C399.8 275.5 363.9 239.8 319.7 240C275.5 240.2 239.8 276.1 240 320.3C240.2 364.5 276.1 400.2 320.3 400z"/>
                                        </svg>
                                    </button> -->
                                </div>
                            </div>
                            <b>Adc Data: </b>
                            <div class="dataGroup" id="adcCollapse">
                                <div>Battery Voltage: <span id="battVoltage">-.---</span>V</div>
                                <div>Reference Voltage: <span id="refVoltage">-.---</span>V</div>
                                <div>I<sub>propI</sub> Voltages: <span id="ipropiVoltages">[-.---V, -.---V, -.---V, -.---V]</span></div>
                                <div>Temperature: <span id="selfTemp">--</span>Â°C</div>
                                <hr>
                                <div>Data taken timestamp: <span id="dataTakenTimestamp">--:--.---</span></div>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="helpers.js"></script>
    <script src="toasts.js"></script>
    <script src="serail_port.js"></script>
    <script src="index.js"></script>
    <script src="3d_viewer_setup.js" type="module"></script>
    <script src="event_listener.js"></script>
</body>
</html>